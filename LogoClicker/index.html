<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brainrot Clicker - Logan Beggs Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: white;
            font-family: 'Comic Sans MS', 'Arial Rounded MT Bold', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 20px 0;
            background: rgba(255, 107, 107, 0.2);
            border-radius: 20px;
            margin-bottom: 25px;
            border: 4px solid #ff6b6b;
            box-shadow: 0 0 40px rgba(255, 107, 107, 0.4);
            position: relative;
            overflow: hidden;
        }

        h1 {
            font-size: 4em;
            background: linear-gradient(45deg, #ff6b6b, #ffd93d, #6bcf7f);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 30px rgba(255, 107, 107, 0.5);
            margin-bottom: 5px;
            animation: titleGlow 3s infinite alternate;
        }

        @keyframes titleGlow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }

        .creator {
            font-size: 1.2em;
            color: #6bcf7f;
            font-style: italic;
            margin-bottom: 10px;
        }

        .tagline {
            font-size: 1.3em;
            color: #ffd93d;
            font-weight: bold;
        }

        .game-area {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            margin-bottom: 25px;
        }

        .clicker-section {
            flex: 1;
            min-width: 350px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 25px;
            padding: 25px;
            border: 3px solid #4d96ff;
            box-shadow: 0 0 25px rgba(77, 150, 255, 0.4);
        }

        .brainrot-display {
            width: 350px;
            height: 350px;
            margin: 0 auto 25px;
            position: relative;
        }

        #mainIcon {
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #ff6b6b, #4d96ff);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8em;
            cursor: pointer;
            user-select: none;
            transition: transform 0.1s, filter 0.3s;
            border: 15px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 60px rgba(255, 107, 107, 0.6);
        }

        #mainIcon:active {
            transform: scale(0.92);
        }

        .stats-section {
            flex: 1;
            min-width: 350px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 25px;
            padding: 25px;
            border: 3px solid #6bcf7f;
            box-shadow: 0 0 25px rgba(107, 207, 127, 0.4);
        }

        .stat {
            display: flex;
            justify-content: space-between;
            margin: 12px 0;
            padding: 12px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            transition: background 0.3s;
        }

        .stat:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #ffd93d;
        }

        .shop-section {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 25px;
            padding: 25px;
            border: 3px solid #9d4edd;
            box-shadow: 0 0 25px rgba(157, 78, 221, 0.4);
            margin-bottom: 25px;
        }

        .shop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .upgrade-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            opacity: 0.5;
            position: relative;
        }

        .upgrade-item.unlocked {
            opacity: 1;
            cursor: pointer;
        }

        .upgrade-item.locked::before {
            content: "üîí";
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5em;
        }

        .upgrade-item.unlocked:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #ff6b6b;
            transform: translateY(-8px);
        }

        .upgrade-item.bought {
            background: rgba(107, 207, 127, 0.2);
            border-color: #6bcf7f;
        }

        .upgrade-name {
            font-size: 1.5em;
            color: #4d96ff;
            margin-bottom: 8px;
        }

        .upgrade-desc {
            color: #ffd93d;
            margin-bottom: 10px;
            font-size: 0.95em;
            min-height: 40px;
        }

        .upgrade-cost {
            color: #ff6b6b;
            font-weight: bold;
            font-size: 1.3em;
            margin-bottom: 8px;
        }

        .upgrade-requirement {
            color: #9d4edd;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .upgrade-count {
            color: #6bcf7f;
            font-weight: bold;
            margin-top: 8px;
            font-size: 1.1em;
        }

        .effects-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .click-effect {
            position: absolute;
            font-size: 2.2em;
            font-weight: bold;
            animation: floatUp 1.2s forwards;
            pointer-events: none;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0) scale(1) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(-120px) scale(0) rotate(360deg);
                opacity: 0;
            }
        }

        .brainrot-particle {
            position: absolute;
            width: 24px;
            height: 24px;
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            border-radius: 50%;
            animation: particleFloat 2.5s forwards;
            pointer-events: none;
        }

        @keyframes particleFloat {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(0);
                opacity: 0;
            }
        }

        .prestige-section {
            text-align: center;
            margin-top: 25px;
            padding: 25px;
            background: linear-gradient(135deg, rgba(157, 78, 221, 0.3), rgba(255, 215, 61, 0.3));
            border-radius: 20px;
            border: 3px solid #9d4edd;
        }

        #prestigeBtn {
            background: linear-gradient(45deg, #9d4edd, #ff6b6b);
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 1.5em;
            border-radius: 60px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            margin-top: 15px;
            box-shadow: 0 10px 25px rgba(157, 78, 221, 0.4);
        }

        #prestigeBtn:hover:not(:disabled) {
            transform: scale(1.12);
            box-shadow: 0 15px 35px rgba(157, 78, 221, 0.6);
        }

        #prestigeBtn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .prestige-icon-info {
            margin-top: 15px;
            color: #ffd93d;
            font-size: 1.1em;
        }

        .prestige-icons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .prestige-icon {
            font-size: 2.5em;
            opacity: 0.3;
            transition: opacity 0.3s;
        }

        .prestige-icon.active {
            opacity: 1;
            transform: scale(1.2);
            filter: drop-shadow(0 0 10px currentColor);
        }

        .logan-mode {
            position: fixed;
            bottom: 25px;
            right: 25px;
            z-index: 1001;
        }

        #loganBtn {
            background: linear-gradient(45deg, #ff0000, #ffff00, #00ff00);
            color: black;
            border: none;
            padding: 15px 30px;
            font-size: 1.3em;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            animation: loganPulse 2s infinite;
        }

        @keyframes loganPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        #loganBtn:hover {
            animation: none;
            transform: scale(1.1) rotate(5deg);
        }

        .achievement-popup {
            position: fixed;
            top: 25px;
            right: 25px;
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            color: black;
            padding: 18px;
            border-radius: 15px;
            animation: slideIn 0.5s, slideOut 0.5s 3s forwards;
            font-weight: bold;
            z-index: 1002;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        .brainrot-meter {
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
            position: relative;
        }

        .brainrot-fill {
            height: 100%;
            background: linear-gradient(90deg, #4d96ff, #9d4edd);
            border-radius: 10px;
            transition: width 0.5s;
            position: relative;
            overflow: hidden;
        }

        .brainrot-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @media (max-width: 900px) {
            .game-area {
                flex-direction: column;
            }
            
            .brainrot-display {
                width: 280px;
                height: 280px;
            }
            
            h1 {
                font-size: 2.8em;
            }
            
            #mainIcon {
                font-size: 6em;
            }
        }

        @media (max-width: 600px) {
            .shop-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="effects-container" id="effects"></div>

    <div class="container">
        <header>
            <h1>üß† BRAINROT CLICKER üß†</h1>
            <div class="creator">Made by Logan Beggs</div>
            <p class="tagline">Click to rot your brain. Prestige to transcend.</p>
            
            <div class="brainrot-meter">
                <div class="brainrot-fill" id="brainrotFill" style="width: 0%"></div>
            </div>
        </header>

        <div class="game-area">
            <div class="clicker-section">
                <h2>üß† CLICK THE BRAINROT üß†</h2>
                <div class="brainrot-display">
                    <div id="mainIcon" onclick="clickBrainrot()">
                        <!-- Icon changes with prestige -->
                    </div>
                </div>
                <div class="stats">
                    <div class="stat">
                        <span>Brainrot Per Click:</span>
                        <span class="stat-value" id="clickPower">1</span>
                    </div>
                    <div class="stat">
                        <span>Brainrot Per Second:</span>
                        <span class="stat-value" id="bps">0</span>
                    </div>
                </div>
            </div>

            <div class="stats-section">
                <h2>üìä BRAINROT STATS üìä</h2>
                <div class="stat">
                    <span>Current Brainrot:</span>
                    <span class="stat-value" id="currentBrainrot">0</span>
                </div>
                <div class="stat">
                    <span>Total Brainrot:</span>
                    <span class="stat-value" id="totalBrainrot">0</span>
                </div>
                <div class="stat">
                    <span>Clicks Made:</span>
                    <span class="stat-value" id="totalClicks">0</span>
                </div>
                <div class="stat">
                    <span>Prestige Level:</span>
                    <span class="stat-value" id="prestigeLevel">0</span>
                </div>
                <div class="stat">
                    <span>Multiplier:</span>
                    <span class="stat-value" id="totalMultiplier">1x</span>
                </div>
            </div>
        </div>

        <div class="shop-section">
            <h2>üõí BRAINROT UPGRADES üõí</h2>
            <p style="color: #ffd93d; text-align: center; margin-bottom: 15px;">Unlocks at 1.5x cost. 2x Multipliers can only be bought once!</p>
            <div class="shop-grid" id="upgradesGrid">
                <!-- Upgrades will be generated by JavaScript -->
            </div>
        </div>

        <div class="prestige-section">
            <h2>‚≠ê PRESTIGE SYSTEM ‚≠ê</h2>
            <p>Reset everything for permanent multipliers and new icons!</p>
            <p>Current Requirement: <span id="prestigeRequirement" style="color:#ffd93d; font-weight:bold;">1,000,000</span> Brainrot</p>
            <p class="prestige-icon-info">Current Icon: <span id="currentIconName">Tung Tung Suhur</span></p>
            
            <div class="prestige-icons" id="prestigeIcons">
                <!-- Prestige icons will be generated -->
            </div>
            
            <button id="prestigeBtn" onclick="prestige()" disabled>PRESTIGE (+0% Bonus)</button>
        </div>
    </div>

    <div class="logan-mode">
        <button id="loganBtn" onclick="activateLoganMode()">ACTIVATE LOGAN MODE</button>
    </div>

    <script>
        // ========== GAME STATE ==========
        let brainrot = 0;
        let totalBrainrot = 0;
        let totalClicks = 0;
        let prestigeLevel = 0;
        let prestigeBonus = 0;
        let loganActive = false;
        let loganTime = 0;
        let totalMultiplier = 1;
        let upgradeCheckInterval = null;

        // Prestige icons (evolve with each prestige)
        const prestigeIcons = [
            { level: 0, emoji: "ü§™", name: "Tung Tung Suhur", color: "#ff6b6b" },
            { level: 1, emoji: "üß†", name: "Brainrot Initiate", color: "#4d96ff" },
            { level: 2, emoji: "üëÅÔ∏è", name: "Third Eye Opening", color: "#9d4edd" },
            { level: 3, emoji: "üåÄ", name: "Mind Vortex", color: "#ffd93d" },
            { level: 4, emoji: "üåà", name: "Rainbow Brain", color: "#6bcf7f" },
            { level: 5, emoji: "üëë", name: "Brainrot King", color: "#ff6b6b" },
            { level: 6, emoji: "üåå", name: "Cosmic Brain", color: "#9d4edd" },
            { level: 7, emoji: "‚ö°", name: "Neural Overload", color: "#ffd93d" },
            { level: 8, emoji: "‚ôæÔ∏è", name: "Infinite Mind", color: "#4d96ff" },
            { level: 9, emoji: "ü¶Ö", name: "Eagle Transcendence", color: "#6bcf7f" },
            { level: 10, emoji: "üëÅÔ∏è‚Äçüó®Ô∏è", name: "Omniscient Being", color: "#ff6b6b" }
        ];

        // ========== UPGRADES DATA ==========
        // Now with BIG price differences and unlock at 1.5x cost
        const upgrades = [
            // BASIC TIER - Big jumps
            { id: 1, name: "Extra Finger", desc: "+1 Brainrot per click", baseCost: 100, cost: 100, count: 0, power: 1, type: "click", unlockAt: 150, max: 50, multiplier: false },
            { id: 2, name: "Brain Cell", desc: "+2 Brainrot per second", baseCost: 500, cost: 500, count: 0, power: 2, type: "auto", unlockAt: 750, max: 40, multiplier: false },
            
            // First 2x Multiplier
            { id: 3, name: "2x Multiplier I", desc: "DOUBLES all Brainrot", baseCost: 2500, cost: 2500, count: 0, power: 2, type: "global", unlockAt: 3750, max: 1, multiplier: true },
            { id: 4, name: "Coffee Boost", desc: "+10 Brainrot per click", baseCost: 5000, cost: 5000, count: 0, power: 10, type: "click", unlockAt: 7500, max: 30, multiplier: false },
            
            // MID TIER - Even bigger jumps
            { id: 5, name: "2x Multiplier II", desc: "DOUBLES all Brainrot", baseCost: 25000, cost: 25000, count: 0, power: 2, type: "global", unlockAt: 37500, max: 1, multiplier: true },
            { id: 6, name: "Brain Farm", desc: "+50 Brainrot per second", baseCost: 50000, cost: 50000, count: 0, power: 50, type: "auto", unlockAt: 75000, max: 20, multiplier: false },
            
            { id: 7, name: "2x Multiplier III", desc: "DOUBLES all Brainrot", baseCost: 250000, cost: 250000, count: 0, power: 2, type: "global", unlockAt: 375000, max: 1, multiplier: true },
            { id: 8, name: "Adderall", desc: "+100 Brainrot per click", baseCost: 500000, cost: 500000, count: 0, power: 100, type: "click", unlockAt: 750000, max: 15, multiplier: false },
            
            // HIGH TIER - Massive jumps
            { id: 9, name: "2x Multiplier IV", desc: "DOUBLES all Brainrot", baseCost: 2500000, cost: 2500000, count: 0, power: 2, type: "global", unlockAt: 3750000, max: 1, multiplier: true },
            { id: 10, name: "Synapse Cluster", desc: "+500 Brainrot per second", baseCost: 5000000, cost: 5000000, count: 0, power: 500, type: "auto", unlockAt: 7500000, max: 10, multiplier: false },
            
            { id: 11, name: "2x Multiplier V", desc: "DOUBLES all Brainrot", baseCost: 25000000, cost: 25000000, count: 0, power: 2, type: "global", unlockAt: 37500000, max: 1, multiplier: true },
            { id: 12, name: "God Complex", desc: "+1,000 Brainrot per click", baseCost: 50000000, cost: 50000000, count: 0, power: 1000, type: "click", unlockAt: 75000000, max: 8, multiplier: false },
            
            // ULTRA TIER - Extreme jumps
            { id: 13, name: "2x Multiplier VI", desc: "DOUBLES all Brainrot", baseCost: 250000000, cost: 250000000, count: 0, power: 2, type: "global", unlockAt: 375000000, max: 1, multiplier: true },
            { id: 14, name: "Neural Network", desc: "+5,000 Brainrot per second", baseCost: 500000000, cost: 500000000, count: 0, power: 5000, type: "auto", unlockAt: 750000000, max: 5, multiplier: false },
            
            { id: 15, name: "2x Multiplier VII", desc: "DOUBLES all Brainrot", baseCost: 2500000000, cost: 2500000000, count: 0, power: 2, type: "global", unlockAt: 3750000000, max: 1, multiplier: true },
            { id: 16, name: "Reality Warper", desc: "+10,000 Brainrot per click", baseCost: 5000000000, cost: 5000000000, count: 0, power: 10000, type: "click", unlockAt: 7500000000, max: 5, multiplier: false },
            
            // GOD TIER - Insane jumps
            { id: 17, name: "2x Multiplier VIII", desc: "DOUBLES all Brainrot", baseCost: 25000000000, cost: 25000000000, count: 0, power: 2, type: "global", unlockAt: 37500000000, max: 1, multiplier: true },
            { id: 18, name: "Brainrot Singularity", desc: "+50,000 Brainrot per second", baseCost: 50000000000, cost: 50000000000, count: 0, power: 50000, type: "auto", unlockAt: 75000000000, max: 3, multiplier: false },
            
            { id: 19, name: "2x Multiplier IX", desc: "DOUBLES all Brainrot", baseCost: 250000000000, cost: 250000000000, count: 0, power: 2, type: "global", unlockAt: 375000000000, max: 1, multiplier: true },
            { id: 20, name: "Omni-Click", desc: "+100,000 Brainrot per click", baseCost: 500000000000, cost: 500000000000, count: 0, power: 100000, type: "click", unlockAt: 750000000000, max: 3, multiplier: false },
            
            // FINAL 2x
            { id: 21, name: "2x Multiplier X", desc: "FINAL DOUBLE", baseCost: 1000000000000, cost: 1000000000000, count: 0, power: 2, type: "global", unlockAt: 1500000000000, max: 1, multiplier: true }
        ];

        // ========== INITIALIZATION ==========
        function init() {
            loadGame();
            updateMainIcon();
            createUpgradeElements();
            createPrestigeIcons();
            updateDisplay();
            gameLoop();
            
            // Start upgrade check interval (FIXES THE 30 SECOND BUG)
            if (upgradeCheckInterval) clearInterval(upgradeCheckInterval);
            upgradeCheckInterval = setInterval(createUpgradeElements, 1000);
        }

        // ========== CLICK FUNCTION ==========
        function clickBrainrot() {
            let clickPower = 1;
            
            // Calculate base click power from click upgrades
            upgrades.forEach(upgrade => {
                if (upgrade.type === "click" && upgrade.count > 0) {
                    clickPower += upgrade.power * upgrade.count;
                }
            });
            
            // Apply total multiplier
            clickPower *= totalMultiplier;
            
            // Apply prestige bonus
            clickPower *= (1 + prestigeBonus / 100);
            
            // Apply Logan mode
            if (loganActive) {
                clickPower *= 10;
            }
            
            // Add brainrot
            brainrot += clickPower;
            totalBrainrot += clickPower;
            totalClicks++;
            
            // Create effects
            createClickEffect(clickPower);
            createParticles(3);
            
            // Check achievements
            checkAchievements();
            
            // Update
            updateDisplay();
            saveGame();
        }

        // ========== VISUAL EFFECTS ==========
        function createClickEffect(amount) {
            const effects = document.getElementById('effects');
            const effect = document.createElement('div');
            effect.className = 'click-effect';
            effect.textContent = `+${formatNumber(amount)} üß†`;
            effect.style.left = `${50 + (Math.random() * 20 - 10)}%`;
            effect.style.top = `${50 + (Math.random() * 20 - 10)}%`;
            effect.style.color = getRandomColor();
            effects.appendChild(effect);
            
            setTimeout(() => effect.remove(), 1200);
        }

        function createParticles(count) {
            const effects = document.getElementById('effects');
            const icon = document.getElementById('mainIcon');
            const rect = icon.getBoundingClientRect();
            
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'brainrot-particle';
                particle.style.left = (rect.left + rect.width / 2) + 'px';
                particle.style.top = (rect.top + rect.height / 2) + 'px';
                particle.style.setProperty('--tx', (Math.random() * 200 - 100) + 'px');
                particle.style.setProperty('--ty', (Math.random() * 200 - 100) + 'px');
                particle.style.background = `linear-gradient(45deg, ${getRandomColor()}, ${getRandomColor()})`;
                effects.appendChild(particle);
                
                setTimeout(() => particle.remove(), 2500);
            }
        }

        function getRandomColor() {
            const colors = ['#ff6b6b', '#4d96ff', '#6bcf7f', '#ffd93d', '#9d4edd'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // ========== UPGRADES SYSTEM (FIXED) ==========
        function createUpgradeElements() {
            const grid = document.getElementById('upgradesGrid');
            grid.innerHTML = '';
            
            upgrades.forEach(upgrade => {
                // UNLOCK AT 1.5x COST (your request)
                const isUnlocked = totalBrainrot >= (upgrade.baseCost * 1.5);
                const canAfford = brainrot >= upgrade.cost;
                const isMaxed = upgrade.count >= upgrade.max;
                const isBought = upgrade.count > 0;
                
                const item = document.createElement('div');
                item.className = `upgrade-item ${isUnlocked ? 'unlocked' : 'locked'} ${isBought ? 'bought' : ''}`;
                
                // Different styling for multiplier upgrades
                if (upgrade.multiplier) {
                    item.style.background = 'rgba(255, 215, 61, 0.1)';
                    item.style.border = '2px solid #ffd93d';
                }
                
                item.innerHTML = `
                    <div class="upgrade-name">${upgrade.name} ${isMaxed ? '‚úÖ' : ''}</div>
                    <div class="upgrade-desc">${upgrade.desc}</div>
                    <div class="upgrade-requirement">Unlocks at: ${formatNumber(upgrade.baseCost * 1.5)} Total Brainrot</div>
                    <div class="upgrade-cost">Cost: ${formatNumber(upgrade.cost)} üß†</div>
                    <div class="upgrade-count">${upgrade.multiplier ? 'One-time 2x' : `Owned: ${upgrade.count}/${upgrade.max}`}</div>
                `;
                
                // ALWAYS update clickability in real-time
                if (isUnlocked && !isMaxed && canAfford) {
                    item.onclick = () => buyUpgrade(upgrade.id);
                    item.style.cursor = 'pointer';
                    item.style.opacity = '1';
                } else if (isMaxed) {
                    item.style.background = 'rgba(107, 207, 127, 0.3)';
                    item.style.borderColor = '#6bcf7f';
                    item.style.cursor = 'default';
                } else if (!isUnlocked) {
                    item.style.cursor = 'default';
                    item.style.opacity = '0.5';
                } else if (isUnlocked && !canAfford) {
                    item.style.cursor = 'default';
                    item.style.opacity = '0.8';
                }
                
                grid.appendChild(item);
            });
        }

        function buyUpgrade(id) {
            const upgrade = upgrades.find(u => u.id === id);
            
            if (!upgrade) return;
            
            // Check if can buy
            if (brainrot >= upgrade.cost && upgrade.count < upgrade.max) {
                // Deduct cost
                brainrot -= upgrade.cost;
                upgrade.count++;
                
                // Apply upgrade effects
                if (upgrade.multiplier) {
                    // 2x multiplier upgrade
                    totalMultiplier *= 2;
                    showAchievement(`2X MULTIPLIER UNLOCKED!`);
                    createParticles(25);
                    
                    // Visual feedback
                    document.getElementById('mainIcon').style.animation = 'pulse 0.5s';
                    setTimeout(() => {
                        document.getElementById('mainIcon').style.animation = '';
                    }, 500);
                }
                
                // Increase cost for next purchase (only for non-multipliers)
                if (!upgrade.multiplier) {
                    upgrade.cost = Math.floor(upgrade.cost * 2.5); // Bigger price jumps
                }
                
                // Update display IMMEDIATELY
                updateDisplay();
                createUpgradeElements(); // Refresh immediately
                saveGame();
            }
        }

        // ========== PRODUCTION CALCULATION ==========
        function calculateBPS() {
            let bps = 0;
            
            // Auto-clickers
            upgrades.forEach(upgrade => {
                if (upgrade.type === "auto" && upgrade.count > 0) {
                    bps += upgrade.power * upgrade.count;
                }
            });
            
            // Apply total multiplier
            bps *= totalMultiplier;
            
            // Apply prestige bonus
            bps *= (1 + prestigeBonus / 100);
            
            // Apply Logan mode
            if (loganActive) {
                bps *= 10;
            }
            
            return bps;
        }

        function calculateClickPower() {
            let power = 1;
            
            // Sum all click upgrades
            upgrades.forEach(upgrade => {
                if (upgrade.type === "click" && upgrade.count > 0) {
                    power += upgrade.power * upgrade.count;
                }
            });
            
            // Apply total multiplier
            power *= totalMultiplier;
            
            // Apply prestige bonus
            power *= (1 + prestigeBonus / 100);
            
            // Apply Logan mode
            if (loganActive) {
                power *= 10;
            }
            
            return power;
        }

        // ========== GAME LOOP ==========
        function gameLoop() {
            const bps = calculateBPS();
            if (bps > 0) {
                brainrot += bps / 10;
                totalBrainrot += bps / 10;
            }
            
            // Update Logan mode timer
            if (loganActive) {
                loganTime--;
                if (loganTime <= 0) {
                    loganActive = false;
                    const btn = document.getElementById('loganBtn');
                    btn.textContent = 'ACTIVATE LOGAN MODE';
                    btn.style.animation = 'loganPulse 2s infinite';
                    document.body.style.animation = '';
                }
            }
            
            // Update prestige button
            const required = 1000000 * Math.pow(10, prestigeLevel);
            const prestigeBtn = document.getElementById('prestigeBtn');
            
            if (brainrot >= required) {
                prestigeBtn.disabled = false;
                const bonus = 10 + prestigeLevel * 5;
                prestigeBtn.textContent = `PRESTIGE (+${bonus}% Bonus)`;
                prestigeBtn.style.background = `linear-gradient(45deg, #6bcf7f, #4d96ff)`;
            } else {
                prestigeBtn.disabled = true;
                prestigeBtn.style.background = `linear-gradient(45deg, #9d4edd, #ff6b6b)`;
            }
            
            // Update brainrot meter
            const fillPercent = Math.min((brainrot / required) * 100, 100);
            document.getElementById('brainrotFill').style.width = `${fillPercent}%`;
            
            updateDisplay();
            setTimeout(gameLoop, 100);
        }

        // ========== PRESTIGE SYSTEM ==========
        function createPrestigeIcons() {
            const container = document.getElementById('prestigeIcons');
            container.innerHTML = '';
            
            prestigeIcons.forEach((icon, index) => {
                const iconEl = document.createElement('div');
                iconEl.className = `prestige-icon ${index <= prestigeLevel ? 'active' : ''}`;
                iconEl.textContent = icon.emoji;
                iconEl.style.color = icon.color;
                iconEl.title = `${icon.name} (Level ${icon.level})`;
                container.appendChild(iconEl);
            });
        }

        function updateMainIcon() {
            const icon = document.getElementById('mainIcon');
            const currentIcon = prestigeIcons[Math.min(prestigeLevel, prestigeIcons.length - 1)];
            
            icon.innerHTML = currentIcon.emoji;
            icon.style.background = `linear-gradient(45deg, ${currentIcon.color}, ${getRandomColor()})`;
            icon.style.boxShadow = `0 0 60px ${currentIcon.color}80`;
            
            document.getElementById('currentIconName').textContent = currentIcon.name;
            document.getElementById('currentIconName').style.color = currentIcon.color;
        }

        function prestige() {
            const required = 1000000 * Math.pow(10, prestigeLevel);
            
            if (brainrot >= required) {
                prestigeLevel++;
                prestigeBonus += 10 + (prestigeLevel - 1) * 5;
                
                // Reset for prestige (keep multiplier upgrades!)
                brainrot = 0;
                totalClicks = 0;
                
                // Reset non-multiplier upgrades
                upgrades.forEach(upgrade => {
                    if (!upgrade.multiplier) {
                        upgrade.count = 0;
                        upgrade.cost = upgrade.baseCost; // Reset to base cost
                    }
                });
                
                // Update icon
                updateMainIcon();
                createPrestigeIcons();
                
                // Achievement
                const iconName = prestigeIcons[Math.min(prestigeLevel, prestigeIcons.length - 1)].name;
                showAchievement(`PRESTIGE ${prestigeLevel}! New Icon: ${iconName}`);
                createParticles(50);
                
                updateDisplay();
                createUpgradeElements();
                saveGame();
            }
        }

        // ========== LOGAN MODE ==========
        function activateLoganMode() {
            if (!loganActive) {
                loganActive = true;
                loganTime = 300;
                
                const btn = document.getElementById('loganBtn');
                btn.textContent = 'LOGAN MODE ACTIVE!';
                btn.style.animation = 'none';
                btn.style.background = 'linear-gradient(45deg, #00ff00, #ffff00, #ff0000)';
                
                document.body.style.animation = 'loganModePulse 0.3s infinite';
                
                setTimeout(() => {
                    loganActive = false;
                    btn.textContent = 'ACTIVATE LOGAN MODE';
                    btn.style.background = 'linear-gradient(45deg, #ff0000, #ffff00, #00ff00)';
                    btn.style.animation = 'loganPulse 2s infinite';
                    document.body.style.animation = '';
                }, 30000);
            }
        }

        // ========== ACHIEVEMENTS ==========
        function checkAchievements() {
            const achievements = [
                { check: () => totalBrainrot >= 1000, text: "1K Brainrot!" },
                { check: () => totalBrainrot >= 10000, text: "10K Brainrot!!" },
                { check: () => totalBrainrot >= 100000, text: "100K Brainrot!!!" },
                { check: () => totalClicks >= 100, text: "100 Clicks!" },
                { check: () => upgrades.some(u => u.multiplier && u.count > 0), text: "First 2x Multiplier!" }
            ];
            
            achievements.forEach(achievement => {
                if (achievement.check() && !localStorage.getItem(`achievement_${achievement.text}`)) {
                    showAchievement(achievement.text);
                    localStorage.setItem(`achievement_${achievement.text}`, 'true');
                }
            });
        }

        function showAchievement(text) {
            const popup = document.createElement('div');
            popup.className = 'achievement-popup';
            popup.textContent = `üèÜ ${text}`;
            document.body.appendChild(popup);
            
            setTimeout(() => popup.remove(), 3000);
        }

        // ========== DISPLAY UPDATE ==========
        function updateDisplay() {
            document.getElementById('currentBrainrot').textContent = formatNumber(brainrot);
            document.getElementById('totalBrainrot').textContent = formatNumber(totalBrainrot);
            document.getElementById('totalClicks').textContent = formatNumber(totalClicks);
            document.getElementById('prestigeLevel').textContent = prestigeLevel;
            document.getElementById('clickPower').textContent = formatNumber(calculateClickPower());
            document.getElementById('bps').textContent = formatNumber(calculateBPS());
            document.getElementById('totalMultiplier').textContent = formatNumber(totalMultiplier) + 'x';
            document.getElementById('prestigeRequirement').textContent = formatNumber(1000000 * Math.pow(10, prestigeLevel));
            
            // Update main icon size
            const icon = document.getElementById('mainIcon');
            const scale = 1 + Math.log10(totalBrainrot + 1) * 0.02;
            icon.style.transform = `scale(${Math.min(scale, 1.3)})`;
        }

        // ========== UTILITIES ==========
        function formatNumber(num) {
            if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
            return Math.floor(num);
        }

        function saveGame() {
            const saveData = {
                brainrot,
                totalBrainrot,
                totalClicks,
                prestigeLevel,
                prestigeBonus,
                totalMultiplier,
                upgrades: upgrades.map(u => ({ id: u.id, count: u.count, cost: u.cost }))
            };
            localStorage.setItem('brainrot_clicker_final', JSON.stringify(saveData));
        }

        function loadGame() {
            const saved = localStorage.getItem('brainrot_clicker_final');
            if (saved) {
                const saveData = JSON.parse(saved);
                brainrot = saveData.brainrot || 0;
                totalBrainrot = saveData.totalBrainrot || 0;
                totalClicks = saveData.totalClicks || 0;
                prestigeLevel = saveData.prestigeLevel || 0;
                prestigeBonus = saveData.prestigeBonus || 0;
                totalMultiplier = saveData.totalMultiplier || 1;
                
                if (saveData.upgrades) {
                    saveData.upgrades.forEach(savedUpgrade => {
                        const upgrade = upgrades.find(u => u.id === savedUpgrade.id);
                        if (upgrade) {
                            upgrade.count = savedUpgrade.count || 0;
                            upgrade.cost = savedUpgrade.cost || upgrade.baseCost;
                        }
                    });
                }
            }
        }

        // ========== START GAME ==========
        window.onload = init;

        // Add animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes loganModePulse {
                0%, 100% { filter: hue-rotate(0deg) brightness(1.2); }
                50% { filter: hue-rotate(180deg) brightness(1.5); }
            }
            
            @keyframes titleGlow {
                0% { filter: hue-rotate(0deg) drop-shadow(0 0 20px #ff6b6b); }
                25% { filter: hue-rotate(90deg) drop-shadow(0 0 20px #4d96ff); }
                50% { filter: hue-rotate(180deg) drop-shadow(0 0 20px #6bcf7f); }
                75% { filter: hue-rotate(270deg) drop-shadow(0 0 20px #ffd93d); }
                100% { filter: hue-rotate(360deg) drop-shadow(0 0 20px #9d4edd); }
            }
            
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.1); }
                100% { transform: scale(1); }
            }
            
            #mainIcon {
                transition: transform 0.3s, background 0.5s;
            }
            
            #mainIcon:hover {
                transform: scale(1.05);
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
